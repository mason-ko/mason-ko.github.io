{"componentChunkName":"component---src-templates-blog-post-js","path":"/2019/2019-03-20-Redis-Cluster/","result":{"data":{"site":{"siteMetadata":{"title":"Mason blog","author":"mason ko","siteUrl":"https://mason-ko.github.io","comment":{"disqusShortName":"","utterances":""},"sponsor":{"buyMeACoffeeId":"jbee"}}},"markdownRemark":{"id":"d63a49a3-b09c-557e-9fd5-853ea04ecf5f","excerpt":"Docker Compose File docker-compose.yaml Info 3개 이상의 마스터를 구성 한쪽 클러스의 영역 ( 마스터, 슬레이브 ) 전부 죽었을 시 Cluster Down으로 동작되지 않음  CLUSTERDOWN The cluster is down 그 후 슬레이브만 부활했을 때에 자동적으로 Master가 되지 않고 계속 Master를 찾음 ( 결국 전부 다 죽었을 때는 Master가 살아 난 이후 정상 동작임 ) Master 가 있을 시 Master로만 사용되며 Master…","html":"<h2 id=\"docker-compose-file\" style=\"position:relative;\"><a href=\"#docker-compose-file\" aria-label=\"docker compose file permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Docker Compose File</h2>\n<p>docker-compose.yaml</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">version: \"3.1\"\nservices:\n  redis-master-1:\n    image: redis:5.0.2-alpine\n    ports:\n      - 7000:7000\n    command: sh -c \"redis-server --port 7000 --cluster-enabled yes --cluster-config-file nodes.conf --cluster-node-timeout 5000\"\n    networks:\n      redisnet:\n        ipv4_address: 10.0.0.2\n  redis-master-2:\n    image: redis:5.0.2-alpine\n    ports:\n      - 7001:7001\n    command: sh -c \"redis-server --port 7001 --cluster-enabled yes --cluster-config-file nodes.conf --cluster-node-timeout 5000\"\n    networks:\n      redisnet:\n        ipv4_address: 10.0.0.3\n    depends_on:\n      - redis-master-1    \n  redis-master-3:\n    image: redis:5.0.2-alpine\n    ports:\n      - 7002:7002\n    command: sh -c \"redis-server --port 7002 --cluster-enabled yes --cluster-config-file nodes.conf --cluster-node-timeout 5000\"\n    networks:\n      redisnet:\n        ipv4_address: 10.0.0.4\n    depends_on:\n      - redis-master-2\n  redis-slave-1:\n    image: redis:5.0.2-alpine\n    ports:\n      - 7003:7003\n    command: sh -c \"redis-server --port 7003 --cluster-enabled yes --cluster-config-file nodes.conf --cluster-node-timeout 5000\"\n    networks:\n      redisnet:\n        ipv4_address: 10.0.0.5\n    depends_on:\n      - redis-master-3\n  redis-slave-2:\n    image: redis:5.0.2-alpine\n    ports:\n      - 7004:7004\n    command: sh -c \"redis-server --port 7004 --cluster-enabled yes --cluster-config-file nodes.conf --cluster-node-timeout 5000\"\n    networks:\n      redisnet:\n        ipv4_address: 10.0.0.6\n    depends_on:\n      - redis-master-3\n  redis-slave-3:\n    image: redis:5.0.2-alpine\n    ports:\n      - 7005:7005\n    command: sh -c \"redis-server --port 7005 --cluster-enabled yes --cluster-config-file nodes.conf --cluster-node-timeout 5000 --daemonize yes &amp;&amp; yes yes | redis-cli --cluster create 10.0.0.2:7000 10.0.0.3:7001 10.0.0.4:7002 10.0.0.5:7003 10.0.0.6:7004 10.0.0.7:7005 --cluster-replicas 1 &amp;&amp; while sleep 3600; do :; done\"\n    networks:\n      redisnet:\n        ipv4_address: 10.0.0.7\n    depends_on:\n      - redis-master-1\n      - redis-master-2\n      - redis-master-3\n      - redis-slave-1\n      - redis-slave-2\nnetworks:\n  redisnet:\n    driver: bridge\n    ipam:\n      config:\n        - subnet: 10.0.0.0/16</code></pre></div>\n<h2 id=\"info\" style=\"position:relative;\"><a href=\"#info\" aria-label=\"info permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Info</h2>\n<p>3개 이상의 마스터를 구성<br>\n한쪽 클러스의 영역 ( 마스터, 슬레이브 ) 전부 죽었을 시 Cluster Down으로<br>\n동작되지 않음  CLUSTERDOWN The cluster is down<br>\n그 후 슬레이브만 부활했을 때에 자동적으로 Master가 되지 않고 계속 Master를 찾음 ( 결국 전부 다 죽었을 때는 Master가 살아 난 이후 정상 동작임 )<br>\nMaster 가 있을 시 Master로만 사용되며 Master가 죽었을 시 Slave가 마스터가 되어 동작함 ( Active - stand by )  </p>\n<hr>\n<p>Redis Cluster를 사용시 Cluster에 대한 Index 정보 ( Hashslot ) 값이 추가로 저장되어야 하기 때문에<br>\n사용하는 Data (memory)가 증가하고 리다이렉션이 필요하기 때문에<br>\n샤딩이 필요없는 소규모에는 Sentinel 사용이 좋을듯</p>\n<h4 id=\"참고\" style=\"position:relative;\"><a href=\"#%EC%B0%B8%EA%B3%A0\" aria-label=\"참고 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>참고</h4>\n<p><a href=\"https://redis.io/topics/cluster-tutorial\">Redis Cluster Tutorial</a>  </p>","frontmatter":{"title":"Redis Cluster","date":"March 20, 2019"}}},"pageContext":{"slug":"/2019/2019-03-20-Redis-Cluster/","previous":{"fields":{"slug":"/2019/2019-03-05-Spark-Cluster/"},"frontmatter":{"title":"Spark Cluster Docker Compose Yaml"}},"next":{"fields":{"slug":"/2019/2019-04-08-Redis-Warning/"},"frontmatter":{"title":"Redis Warning 해결"}}}},"staticQueryHashes":["2486386679","3128451518"]}